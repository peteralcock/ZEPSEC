class ChangeVulnerabilityStateType< ActiveRecord::Migration[5.1]
  disable_ddl_transaction!

  def change
    reversible do |change|
      change.up do
        execute <<-SQL
          ALTER TYPE vuln_state
          ADD VALUE 'not_published'
          AFTER 'published';
        SQL
      end

      change.down do
        execute <<-SQL
          DELETE FROM pg_enum
          WHERE enumlabel = 'not_published'
          AND enumtypid = (
            SELECT oid FROM pg_type WHERE typname = 'vuln_state'
          )
        SQL
      end
    end
  end
end
